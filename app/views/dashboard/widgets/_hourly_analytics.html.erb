<%= plan_access_overlay('pro') do %>
  <div class="bg-white shadow rounded-lg">
    <div class="px-4 py-5 sm:p-6">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg leading-6 font-medium text-gray-900">📊 Análises de Horário</h3>
        <div class="flex items-center space-x-2">
          <span class="text-sm text-gray-500">Cliques únicos</span>
          <button class="text-gray-400 hover:text-gray-600">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path>
            </svg>
          </button>
        </div>
      </div>

      <!-- Novo layout melhorado do heatmap -->
      <div class="space-y-3">
        <!-- Períodos do dia -->
        <div class="grid grid-cols-4 gap-3 mb-4">
          <% 
            periods = [
              { name: "Madrugada", hours: "00h-05h", color: "bg-blue-500", intensity: 1 },
              { name: "Manhã", hours: "06h-11h", color: "bg-green-500", intensity: 3 },
              { name: "Tarde", hours: "12h-17h", color: "bg-orange-500", intensity: 5 },
              { name: "Noite", hours: "18h-23h", color: "bg-purple-500", intensity: 4 }
            ]
          %>
          <% periods.each do |period| %>
            <div class="text-center p-3 rounded-lg border border-gray-200 hover:shadow-md transition-shadow">
              <div class="<%= period[:color] %> w-full h-3 rounded-full mb-2 opacity-<%= period[:intensity] * 20 %>"></div>
              <div class="text-sm font-medium text-gray-900"><%= period[:name] %></div>
              <div class="text-xs text-gray-500"><%= period[:hours] %></div>
              <div class="text-lg font-bold text-gray-800 mt-1"><%= period[:intensity] * 20 %></div>
              <div class="text-xs text-gray-400">cliques</div>
            </div>
          <% end %>
        </div>

        <!-- Heatmap horizontal melhorado com horários visíveis -->
        <div class="bg-gray-50 p-4 rounded-lg">
          <h4 class="text-sm font-medium text-gray-700 mb-3">Distribuição por Hora</h4>
          
          <!-- Grid de 24 horas -->
          <div class="grid grid-cols-12 gap-2">
            <% (0..23).each do |hour| %>
              <% 
                # Simular intensidade baseada em horários mais comuns
                intensity = case hour
                when 0..5   then rand(1..2)   # Madrugada - baixa
                when 6..8   then rand(2..4)   # Manhã cedo - média
                when 9..11  then rand(4..7)   # Manhã - alta
                when 12..14 then rand(6..9)   # Almoço/tarde - muito alta
                when 15..17 then rand(7..10)  # Tarde - pico
                when 18..20 then rand(5..8)   # Início noite - alta
                when 21..23 then rand(3..6)   # Noite - média
                end
                
                # Cores baseadas na intensidade
                color_class = case intensity
                when 1..2   then "bg-blue-200 text-blue-800"
                when 3..4   then "bg-green-300 text-green-800"
                when 5..6   then "bg-yellow-400 text-yellow-900"
                when 7..8   then "bg-orange-500 text-white"
                when 9..10  then "bg-red-500 text-white"
                else "bg-gray-200 text-gray-600"
                end
              %>
              <div class="relative group">
                <div class="<%= color_class %> h-16 rounded-lg flex flex-col items-center justify-center text-xs font-medium transition-transform hover:scale-105 cursor-pointer shadow-sm">
                  <!-- Hora sempre visível -->
                  <div class="text-xs font-bold"><%= sprintf("%02d", hour) %>h</div>
                  <!-- Número de cliques -->
                  <div class="text-lg font-bold"><%= intensity %></div>
                </div>
                
                <!-- Tooltip melhorado -->
                <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-10">
                  <div class="bg-gray-900 text-white text-xs rounded-lg py-2 px-3 whitespace-nowrap">
                    <div class="font-semibold"><%= sprintf("%02d:00 - %02d:59", hour, hour) %></div>
                    <div><%= intensity %> cliques únicos</div>
                    <div class="text-gray-300">
                      <%= case hour
                      when 0..5   then "😴 Madrugada"
                      when 6..11  then "🌅 Manhã"
                      when 12..17 then "☀️ Tarde"
                      else "🌙 Noite"
                      end %>
                    </div>
                  </div>
                  <!-- Seta do tooltip -->
                  <div class="absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-900"></div>
                </div>
              </div>
            <% end %>
          </div>
        </div>

        <!-- Insights automáticos -->
        <div class="bg-blue-50 p-4 rounded-lg">
          <div class="flex items-start space-x-3">
            <div class="flex-shrink-0">
              <svg class="w-5 h-5 text-blue-500 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
            </div>
            <div class="flex-1">
              <h4 class="text-sm font-medium text-blue-900">💡 Insights Automáticos</h4>
              <div class="mt-2 text-sm text-blue-800 space-y-1">
                <div>🔥 <strong>Horário de pico:</strong> 14h-17h (período da tarde)</div>
                <div>📈 <strong>Melhor conversão:</strong> 15h-16h</div>
                <div>💤 <strong>Menor atividade:</strong> 02h-05h</div>
                <div>📊 <strong>Recomendação:</strong> Foque campanhas entre 12h-18h</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
<% end %>
